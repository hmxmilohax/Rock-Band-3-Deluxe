#define TRACK_END_FRAME
(1920)
#define TRACK_PANEL_HANDLERS
((enter
      {game add_sink $this}
      {$this
         set_showing
         {!
            {gamemode in_mode practice}}})
   (exit
      {game remove_sink $this})
   (unison_hit)
   (set_track_out)
   (set_track_in)
   (animate_track
      ($start $end $period $units))
   (animate_track_out)
   (animate_track_out_fast)
   (animate_track_in_fast)
   (finish_load
      {$this set_showing FALSE}
      {$this set_track_out})
   (intro_start
      {$this track_reset}
      {$this set_showing TRUE}
      {$this set_track_in})
   (intro_skip
      {$this track_reset}
      {$this set_showing TRUE}
      {$this set_track_out})
   (on_reset
      {beatmatch
         foreach_active_player
         $m
         {$m on_new_track}})
   (on_extend
      {$this play_intro}
      {if
         {&&
            {exists gamemode}
            {gamemode get play_track_intro_sfx}}
         {$this play_seq track_beg.cue}
         #ifdef HX_XBOX
         {unless
            {'||'
               {gamemode in_mode audition}
               {&&
                  {gamemode in_mode practice}
                  {>
                     {gamecfg get practice_speed}
                     0}}}
            {beatmatch set_music_speed $speedmod}}
         #else
         {unless
            {&&
               {gamemode in_mode practice}
               {>
                  {gamecfg get practice_speed}
                  0}}
            {beatmatch set_music_speed $speedmod}}
         #endif
         {if
            {&&
               {gamemode in_mode practice}
               {>
                  {gamecfg get practice_speed}
                  0}}
            {beatmatch set_music_speed $modifier}}}
{if $animatedgems
{set $framecount 0}
{thread_task kTaskSeconds (script
{set $framecount {+ $framecount 1}}
{if {>= $framecount 120} {set $framecount 0}}

{gem_cymbal_diffuse.tex set_bitmap {sprint "ui/track/custom_track_textures/gem_cymbal_diffuse/gem_cymbal_diffuse_" $framecount ".png"}}

{gem_cymbal_ems.tex set_bitmap {sprint "ui/track/custom_track_textures/gem_cymbal_diffuse/gem_cymbal_diffuse_" $framecount ".png"}}

{prism_gems.tex set_bitmap {sprint "ui/track/custom_track_textures/prism_gems/prism_gems_" $framecount ".png"}}

{prism_gem_emissive.tex set_bitmap {sprint "ui/track/custom_track_textures/prism_gems/prism_gems_" $framecount ".png"}}

{prism_gem_keyboard_style.tex set_bitmap {sprint "ui/track/custom_track_textures/prism_gem_keyboard_style/prism_gem_keyboard_style_" $framecount ".png"}}

{$task sleep 0.016}
{$task loop})}
}

{if $rb4ui
      {gem_cymbal_diffuse.tex set_bitmap {sprint "ui/track/custom_track_textures/gem_cymbal_diffuse/gem_cymbal_diffuse_0.png"}}
      {gem_cymbal_ems.tex set_bitmap {sprint "ui/track/custom_track_textures/gem_cymbal_diffuse/gem_cymbal_diffuse_0.png"}}
      {prism_gems.tex set_bitmap {sprint "ui/track/custom_track_textures/prism_gems/prism_gems_0.png"}}
      {prism_gem_emissive.tex set_bitmap {sprint "ui/track/custom_track_textures/prism_gems/prism_gems_0.png"}}
      {prism_gem_keyboard_style.tex set_bitmap {sprint "ui/track/custom_track_textures/prism_gem_keyboard_style/prism_gem_keyboard_style_0.png"}}
      {score_star_frame.tex set_bitmap ui/track/custom_track_textures/score_star_frame.png}
      {score_star_gold.tex set_bitmap ui/track/custom_track_textures/score_star_gold.png}
      {rb3_icons.tex set_bitmap ui/track/custom_track_textures/rb3_icons.png}
      {scoreboard_frame.tex set_bitmap ui/track/custom_track_textures/scoreboard_frame.png}
      {scoreboard_lens.tex set_bitmap ui/track/custom_track_textures/_no_highway.png}
      {crowd_meter_frame.tex set_bitmap ui/track/custom_track_textures/crowd_meter_frame.png}
      {crowd_meter_lens.tex set_bitmap ui/track/custom_track_textures/_no_highway.png}
      {gem_smashers_guitar_nomip.tex set_bitmap ui/track/custom_track_textures/gem_smashers_guitar_nomip.png}
      {gem_smashers_guitar.tex set_bitmap ui/track/custom_track_textures/gem_smashers_guitar_nomip.png}
      {square_smasher_bright_green.tex set_bitmap ui/track/custom_track_textures/square_smasher_bright_green.png}
      {square_smasher_bright_red.tex set_bitmap ui/track/custom_track_textures/square_smasher_bright_red.png}
      {square_smasher_bright_yellow.tex set_bitmap ui/track/custom_track_textures/square_smasher_bright_yellow.png}
      {square_smasher_bright_blue.tex set_bitmap ui/track/custom_track_textures/square_smasher_bright_blue.png}
      {square_smasher_bright_orange.tex set_bitmap ui/track/custom_track_textures/square_smasher_bright_orange.png}}
      {unless $defaultemissive
      {spotlight_bass_track_emissive.tex set_bitmap {sprint "ui/track/emissives/" $emissive ".png"}}
      {spotlight_drums_track_emissive.tex set_bitmap {sprint "ui/track/emissives/" $emissive ".png"}}
      {spotlight_guitar_track_emmissive.tex set_bitmap {sprint "ui/track/emissives/" $emissive ".png"}}
      {spotlight_keys_track_emissive.tex set_bitmap {sprint "ui/track/emissives/" $emissive ".png"}}
      {spotlight_prokeys_track_emissive.tex set_bitmap {sprint "ui/track/emissives/" $emissive ".png"}}}
      {unless $defaultspotlight
      {spotlight_guitar_track.tex set_bitmap {sprint "ui/track/spotlights/" $spotlight ".png"}}
      {spotlight_bass_track.tex set_bitmap {sprint "ui/track/spotlights/" $spotlight ".png"}}
      {spotlight_drums_track.tex set_bitmap {sprint "ui/track/spotlights/" $spotlight ".png"}}
      {spotlight_prokeys_track.tex set_bitmap {sprint "ui/track/spotlights/" $spotlight ".png"}}
      {spotlight_keys_track.tex set_bitmap {sprint "ui/track/spotlights/" $spotlight ".png"}}}
      {unless $defaulthighway
      {watermark_guitar.tex set_bitmap {sprint "ui/track/surfaces/" $highway ".png"}}
      {watermark_bass.tex set_bitmap {sprint "ui/track/surfaces/" $highway ".png"}}
      {watermark_drum.tex set_bitmap {sprint "ui/track/surfaces/" $highway ".png"}}
      {watermark_keys.tex set_bitmap {sprint "ui/track/surfaces/" $highway ".png"}}}
))
{new
   TrackPanel
   coop_track_panel
   (file
      "track/trackpanel.milo")
   TRACK_PANEL_HANDLERS}
{func
   get_track_panel
   {gamemode get track_panel}}
{set
   $playback_file
   ""}