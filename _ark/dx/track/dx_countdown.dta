#define DX_COUNTDOWN_TRACKER
(
   {if
      {||
         {! {gamemode in_mode practice}} {! {gamemode in_mode training}}
      }
      {beatmatch foreach_active_player $player ;dx - add our custom fc checking callbacks to the currently loaded player
         {if {== {$player instrument} vocals}
            {if $dx_countdown_enabled
               {unless $delay_tracked_vocals
                  {foreach $entry $vocals_note_tracker
                     {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_vocals}}
                        {set $tracked_beat_no_notes_start_vocals {elem {find $entry {sprint "delay_" $current_tracked_beat_vocals}} 1}}
                        {set $tracked_beat_no_notes_end_vocals {elem {find $entry {sprint "delay_" $current_tracked_beat_vocals}} 2}}
                        {set $delay_tracked_vocals TRUE}
                     }
                  }
               }
               {if $delay_tracked_vocals
                  {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_vocals}
                     {dx_check_beat {- $tracked_beat_no_notes_end_vocals {dx_get_current_beat}}}
                  }
               }
            }
         }
         {switch {{$player get_user} get_slot_num}
            (0
               {switch {$player instrument}
                  ((bass real_bass)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_0
                           {foreach $entry $bass_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_0}}
                                 {set $tracked_beat_no_notes_start_bass {elem {find $entry {sprint "delay_" $current_tracked_beat_0}} 1}}
                                 {set $tracked_beat_no_notes_end_bass {elem {find $entry {sprint "delay_" $current_tracked_beat_0}} 2}}
                                 {set $delay_tracked_0 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_0
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_bass}
                              {dx_check_beat {- $tracked_beat_no_notes_end_bass {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_bass 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_bass 7}} {dx_final_percent_report}}
                     }
                  )
                  ((keys real_keys)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_0
                           {foreach $entry $keys_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_0}}
                                 {set $tracked_beat_no_notes_start_keys {elem {find $entry {sprint "delay_" $current_tracked_beat_0}} 1}}
                                 {set $tracked_beat_no_notes_end_keys {elem {find $entry {sprint "delay_" $current_tracked_beat_0}} 2}}
                                 {dx_log_writer countdown {sprint "Keys delay_" $current_tracked_beat_0 " found, Keys Start: " $tracked_beat_no_notes_start_keys ", Keys End: " $tracked_beat_no_notes_end_keys ", Current Beat: " {dx_get_current_beat}}}
                                 {set $delay_tracked_0 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_0
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_keys}
                              {unless $dx_log_stopper
                                 {set $dx_log_stopper TRUE}
                                 {dx_log_writer countdown {sprint "Current Beat: " {dx_get_current_beat} " matches keys break start: " $tracked_beat_no_notes_start_keys ", counting down to end of keys break at: " $tracked_beat_no_notes_end_keys}}
                              }
                              {dx_check_beat {- $tracked_beat_no_notes_end_keys {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_keys 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_keys 7}} {dx_final_percent_report}}
                     }
                  )
                  ((guitar real_guitar)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_0
                           {foreach $entry $guitar_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_0}}
                                 {set $tracked_beat_no_notes_start_guitar {elem {find $entry {sprint "delay_" $current_tracked_beat_0}} 1}}
                                 {set $tracked_beat_no_notes_end_guitar {elem {find $entry {sprint "delay_" $current_tracked_beat_0}} 2}}
                                 {dx_log_writer countdown {sprint "Guitar delay_" $current_tracked_beat_0 " found, Guitar Start: " $tracked_beat_no_notes_start_guitar ", Guitar End: " $tracked_beat_no_notes_end_guitar ", Current Beat: " {dx_get_current_beat}}}
                                 {set $delay_tracked_0 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_0
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_guitar}
                              {unless $dx_log_stopper
                                 {set $dx_log_stopper TRUE}
                                 {dx_log_writer countdown {sprint "Current Beat: " {dx_get_current_beat} " matches guitar break start: " $tracked_beat_no_notes_start_guitar ", counting down to end of guitar break at: " $tracked_beat_no_notes_end_guitar}}
                              }
                              {dx_check_beat {- $tracked_beat_no_notes_end_guitar {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_guitar 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_guitar 7}} {dx_final_percent_report}}
                     }
                  )
                  ((drum real_drum)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_0
                           {foreach $entry $drum_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_0}}
                                 {set $tracked_beat_no_notes_start_drum {elem {find $entry {sprint "delay_" $current_tracked_beat_0}} 1}}
                                 {set $tracked_beat_no_notes_end_drum {elem {find $entry {sprint "delay_" $current_tracked_beat_0}} 2}}
                                 {dx_log_writer countdown {sprint "Drum delay_" $current_tracked_beat_0 " found, Drum Start: " $tracked_beat_no_notes_start_drum ", Drum End: " $tracked_beat_no_notes_end_drum ", Current Beat: " {dx_get_current_beat}}}
                                 {set $delay_tracked_0 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_0
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_drum}
                              {unless $dx_log_stopper
                                 {set $dx_log_stopper TRUE}
                                 {dx_log_writer countdown {sprint "Current Beat: " {dx_get_current_beat} " matches drum break start: " $tracked_beat_no_notes_start_drum ", counting down to end of drum break at: " $tracked_beat_no_notes_end_drum}}
                              }
                              {dx_check_beat {- $tracked_beat_no_notes_end_drum {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_drum 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_drum 7}} {dx_final_percent_report}}
                     }
                  )
                  (vocals kDataUnhandled) ;lol vocals
               }
            )
            (1
               {switch {$player instrument}
                  ((bass real_bass)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_1
                           {foreach $entry $bass_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_1}}
                                 {set $tracked_beat_no_notes_start_bass {elem {find $entry {sprint "delay_" $current_tracked_beat_1}} 1}}
                                 {set $tracked_beat_no_notes_end_bass {elem {find $entry {sprint "delay_" $current_tracked_beat_1}} 2}}
                                 {set $delay_tracked_1 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_1
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_bass}
                              {dx_check_beat {- $tracked_beat_no_notes_end_bass {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_bass 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_bass 7}} {dx_final_percent_report}}
                     }
                  )
                  ((keys real_keys)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_1
                           {foreach $entry $keys_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_1}}
                                 {set $tracked_beat_no_notes_start_keys {elem {find $entry {sprint "delay_" $current_tracked_beat_1}} 1}}
                                 {set $tracked_beat_no_notes_end_keys {elem {find $entry {sprint "delay_" $current_tracked_beat_1}} 2}}
                                 {set $delay_tracked_1 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_1
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_keys}
                              {dx_check_beat {- $tracked_beat_no_notes_end_keys {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_keys 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_keys 7}} {dx_final_percent_report}}
                     }
                  )
                  ((guitar real_guitar)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_1
                           {foreach $entry $guitar_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_1}}
                                 {set $tracked_beat_no_notes_start_guitar {elem {find $entry {sprint "delay_" $current_tracked_beat_1}} 1}}
                                 {set $tracked_beat_no_notes_end_guitar {elem {find $entry {sprint "delay_" $current_tracked_beat_1}} 2}}
                                 {set $delay_tracked_1 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_1
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_guitar}
                              {dx_check_beat {- $tracked_beat_no_notes_end_guitar {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_guitar 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_guitar 7}} {dx_final_percent_report}}
                     }
                  )
                  ((drum real_drum)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_1
                           {foreach $entry $drum_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_1}}
                                 {set $tracked_beat_no_notes_start_drum {elem {find $entry {sprint "delay_" $current_tracked_beat_1}} 1}}
                                 {set $tracked_beat_no_notes_end_drum {elem {find $entry {sprint "delay_" $current_tracked_beat_1}} 2}}
                                 {set $delay_tracked_1 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_1
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_drum}
                              {dx_check_beat {- $tracked_beat_no_notes_end_drum {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_drum 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_drum 7}} {dx_final_percent_report}}
                     }
                  )
                  (vocals kDataUnhandled) ;lol vocals
               }
            )
            (2
               {switch {$player instrument}
                  ((bass real_bass)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_2
                           {foreach $entry $bass_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_2}}
                                 {set $tracked_beat_no_notes_start_bass {elem {find $entry {sprint "delay_" $current_tracked_beat_2}} 1}}
                                 {set $tracked_beat_no_notes_end_bass {elem {find $entry {sprint "delay_" $current_tracked_beat_2}} 2}}
                                 {set $delay_tracked_2 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_2
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_bass}
                              {dx_check_beat {- $tracked_beat_no_notes_end_bass {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_bass 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_bass 7}} {dx_final_percent_report}}
                     }
                  )
                  ((keys real_keys)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_2
                           {foreach $entry $keys_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_2}}
                                 {set $tracked_beat_no_notes_start_keys {elem {find $entry {sprint "delay_" $current_tracked_beat_2}} 1}}
                                 {set $tracked_beat_no_notes_end_keys {elem {find $entry {sprint "delay_" $current_tracked_beat_2}} 2}}
                                 {set $delay_tracked_2 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_2
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_keys}
                              {dx_check_beat {- $tracked_beat_no_notes_end_keys {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_keys 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_keys 7}} {dx_final_percent_report}}
                     }
                  )
                  ((guitar real_guitar)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_2
                           {foreach $entry $guitar_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_2}}
                                 {set $tracked_beat_no_notes_start_guitar {elem {find $entry {sprint "delay_" $current_tracked_beat_2}} 1}}
                                 {set $tracked_beat_no_notes_end_guitar {elem {find $entry {sprint "delay_" $current_tracked_beat_2}} 2}}
                                 {set $delay_tracked_2 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_2
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_guitar}
                              {dx_check_beat {- $tracked_beat_no_notes_end_guitar {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_guitar 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_guitar 7}} {dx_final_percent_report}}
                     }
                  )
                  ((drum real_drum)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_2
                           {foreach $entry $drum_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_2}}
                                 {set $tracked_beat_no_notes_start_drum {elem {find $entry {sprint "delay_" $current_tracked_beat_2}} 1}}
                                 {set $tracked_beat_no_notes_end_drum {elem {find $entry {sprint "delay_" $current_tracked_beat_2}} 2}}
                                 {set $delay_tracked_2 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_2
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_drum}
                              {dx_check_beat {- $tracked_beat_no_notes_end_drum {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_drum 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_drum 7}} {dx_final_percent_report}}
                     }
                  )
                  (vocals kDataUnhandled) ;lol vocals
               }
            )
            (3
               {switch {$player instrument}
                  ((bass real_bass)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_3
                           {foreach $entry $bass_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_3}}
                                 {set $tracked_beat_no_notes_start_bass {elem {find $entry {sprint "delay_" $current_tracked_beat_3}} 1}}
                                 {set $tracked_beat_no_notes_end_bass {elem {find $entry {sprint "delay_" $current_tracked_beat_3}} 2}}
                                 {set $delay_tracked_3 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_3
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_bass}
                              {dx_check_beat {- $tracked_beat_no_notes_end_bass {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_bass 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_bass 7}} {dx_final_percent_report}}
                     }
                  )
                  ((keys real_keys)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_3
                           {foreach $entry $keys_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_3}}
                                 {set $tracked_beat_no_notes_start_keys {elem {find $entry {sprint "delay_" $current_tracked_beat_3}} 1}}
                                 {set $tracked_beat_no_notes_end_keys {elem {find $entry {sprint "delay_" $current_tracked_beat_3}} 2}}
                                 {set $delay_tracked_3 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_3
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_keys}
                              {dx_check_beat {- $tracked_beat_no_notes_end_keys {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_keys 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_keys 7}} {dx_final_percent_report}}
                     }
                  )
                  ((guitar real_guitar)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_3
                           {foreach $entry $guitar_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_3}}
                                 {set $tracked_beat_no_notes_start_guitar {elem {find $entry {sprint "delay_" $current_tracked_beat_3}} 1}}
                                 {set $tracked_beat_no_notes_end_guitar {elem {find $entry {sprint "delay_" $current_tracked_beat_3}} 2}}
                                 {set $delay_tracked_3 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_3
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_guitar}
                              {dx_check_beat {- $tracked_beat_no_notes_end_guitar {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_guitar 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_guitar 7}} {dx_final_percent_report}}
                     }
                  )
                  ((drum real_drum)
                     {if $dx_countdown_enabled
                        {unless $delay_tracked_3
                           {foreach $entry $drum_note_tracker
                              {if {== {elem $entry 0} {sprint "delay_" $current_tracked_beat_3}}
                                 {set $tracked_beat_no_notes_start_drum {elem {find $entry {sprint "delay_" $current_tracked_beat_3}} 1}}
                                 {set $tracked_beat_no_notes_end_drum {elem {find $entry {sprint "delay_" $current_tracked_beat_3}} 2}}
                                 {set $delay_tracked_3 TRUE}
                              }
                           }
                        }
                        {if $delay_tracked_3
                           {if {>= {dx_get_current_beat} $tracked_beat_no_notes_start_drum}
                              {dx_check_beat {- $tracked_beat_no_notes_end_drum {dx_get_current_beat}}}
                           }
                        }
                     }
                     {if $dx_end_song_feedback
                        {if {== {dx_get_current_beat} {+ $dx_final_note_drum 1}} {dx_show_solo_box} {dx_final_note_report}}
                        {if {== {dx_get_current_beat} {+ $dx_final_note_drum 7}} {dx_final_percent_report}}
                     }
                  )
                  (vocals kDataUnhandled) ;lol vocals
               }
            )
         }
      }
      {dx_log_writer countdown {sprint "Current Beat: " {dx_get_current_beat}}}
   }
)